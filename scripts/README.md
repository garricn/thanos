# Scripts Directory

This directory contains various utility scripts used for building, testing, and maintaining the project.

## SonarCloud Integration Scripts

### cleanup-test-reports.js

This script manages the test execution reports needed by SonarCloud. It performs the following:

1. Checks if `test-report.xml` exists at the root directory (generated by jest-sonar-reporter)
2. If found, copies it to `coverage/sonar-report.xml` which is the location expected by SonarCloud
3. Removes the original `test-report.xml` file to keep the directory clean
4. If no report is found, it falls back to running `jest-to-sonar.js` to generate a mock report

This script is automatically run as part of the `test:sonar` npm script and in the GitHub Actions workflow.

### jest-to-sonar.js

This script is a fallback for generating SonarQube-compatible test execution reports when the normal test process doesn't generate one. It follows a simplified approach:

1. First checks if `coverage/sonar-report.xml` already exists
2. If not, looks for `junit.xml` files in the NX coverage structure
3. If still no results found, generates mock test data
4. Creates or updates the `coverage/sonar-report.xml` file

The script has been streamlined to focus only on the specific paths where test results would be found in this project, making it efficient and straightforward.

## Usage

These scripts are automatically called by various npm scripts:

```json
"test:sonar": "rm -rf coverage && rm -rf node_modules/.cache && rm -rf .nx/cache && nx reset && JEST_SONAR_REPORTER_OUTPUT_DIR='./coverage' JEST_SONAR_REPORTER_OUTPUT_NAME='sonar-report.xml' nx run-many -t test --projects=web,api --coverage --testResultsProcessor=jest-sonar-reporter && find coverage/apps -name \"lcov.info\" -exec cat {} \\; > coverage/lcov.info && node scripts/cleanup-test-reports.js"
```

You can also run them directly:

```bash
# Clean up test reports and ensure they're in the right location
node scripts/cleanup-test-reports.js

# Generate a mock sonar report if needed
node scripts/jest-to-sonar.js
```
